!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).DMVAST=t()}}((function(){return function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[o]={exports:{}};e[o][0].call(c.exports,(function(t){var i=e[o][1][t];return r(i||t)}),c,c.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function s(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,i,n,a,l,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(o(i=this._events[t]))return!1;if(r(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(s(i))for(a=Array.prototype.slice.call(arguments,1),n=(u=i.slice()).length,l=0;l<n;l++)u[l].apply(this,a);return!0},n.prototype.addListener=function(t,e){var i;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){if(!r(e))throw TypeError("listener must be a function");var i=!1;function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var i,n,o,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(o=(i=this._events[t]).length,n=-1,i===e||r(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(i)){for(a=o;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){n=a;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,i){var n;n=function(){this.id=null,this.sequence=null,this.system=null,this.title=null,this.description=null,this.advertiser=null,this.pricing=null,this.survey=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[]},e.exports=n},{}],3:[function(t,e,i){var n,r,s;r=t("./parser"),s=t("./util"),n=function(){function t(){}var e,n;return t.cappingFreeLunch=0,t.cappingMinimumTimeInterval=0,t.options={withCredentials:!1,timeout:0},t.get=function(t,e,n){var s,o,a,l;if(o=+new Date,s=i.extend=function(t,e){var i,n;for(i in e)n=e[i],t[i]=n;return t},n||("function"==typeof e&&(n=e),a={}),a=s(this.options,e),this.totalCallsTimeout<o?(this.totalCalls=1,this.totalCallsTimeout=o+36e5):this.totalCalls++,!(this.cappingFreeLunch>=this.totalCalls)){if((l=o-this.lastSuccessfullAd)<0)this.lastSuccessfullAd=0;else if(l<this.cappingMinimumTimeInterval)return void n(null,new Error("VAST call canceled – ("+this.cappingMinimumTimeInterval+")ms minimum interval reached"));return r.parse(t,a,(function(t,e){return n(t,e)}))}n(null,new Error("VAST call canceled – FreeLunch capping not reached yet "+this.totalCalls+"/"+this.cappingFreeLunch))},n=s.storage,e=Object.defineProperty,["lastSuccessfullAd","totalCalls","totalCallsTimeout"].forEach((function(i){e(t,i,{get:function(){return n.getItem(i)},set:function(t){return n.setItem(i,t)},configurable:!1,enumerable:!0})})),null==t.lastSuccessfullAd&&(t.lastSuccessfullAd=0),null==t.totalCalls&&(t.totalCalls=0),null==t.totalCallsTimeout&&(t.totalCallsTimeout=0),t}(),e.exports=n},{"./parser":12,"./util":18}],4:[function(t,e,i){var n;n=function(){this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.altText=null,this.companionClickThroughURLTemplate=null,this.companionClickTrackingURLTemplates=[],this.trackingEvents={}},e.exports=n},{}],5:[function(t,e,i){var n,r,s,o,a=function(t,e){for(var i in e)l.call(e,i)&&(t[i]=e[i]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplates=[],this.videoCustomClickURLTemplates=[],this.adParameters=null,this.icons=[]}return a(e,t),e}(n=function(t){null==t&&(t={}),this.id=t.id||null,this.adId=t.adId||null,this.sequence=t.sequence||null,this.apiFramework=t.apiFramework||null,this.trackingEvents={}}),o=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.type="nonlinear",this.variations=[]}return a(e,t),e}(n),r=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.type="companion",this.variations=[]}return a(e,t),e}(n),e.exports={VASTCreativeLinear:s,VASTCreativeNonLinear:o,VASTCreativeCompanion:r}},{}],6:[function(t,e,i){var n;n=function(){this.attributes={},this.children=[]},e.exports=n},{}],7:[function(t,e,i){var n;n=function(){this.name=null,this.value=null,this.attributes={}},e.exports=n},{}],8:[function(t,e,i){var n;n=function(){this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null},e.exports=n},{}],9:[function(t,e,i){e.exports={client:t("./client"),tracker:t("./tracker"),parser:t("./parser"),util:t("./util")}},{"./client":3,"./parser":12,"./tracker":14,"./util":18}],10:[function(t,e,i){var n;n=function(){this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null},e.exports=n},{}],11:[function(t,e,i){var n;n=function(){this.id=null,this.width=0,this.height=0,this.expandedWidth=0,this.expandedHeight=0,this.scalable=!0,this.maintainAspectRatio=!0,this.minSuggestedDuration=0,this.apiFramework="static",this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null,this.nonlinearClickTrackingURLTemplates=[],this.adParameters=null},e.exports=n},{}],12:[function(t,e,i){var n,r,s,o,a,l,u,c,h,p,d,f,m,g,v,T=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};r=t("./urlhandler"),g=t("./response"),s=t("./ad"),o=t("./extension"),a=t("./extensionchild"),v=t("./util"),c=t("./creative").VASTCreativeLinear,u=t("./creative").VASTCreativeCompanion,h=t("./creative").VASTCreativeNonLinear,d=t("./mediafile"),p=t("./icon"),l=t("./companionad"),f=t("./nonlinear"),n=t("events").EventEmitter,m=function(){var t;function e(){}return t=[],e.addURLTemplateFilter=function(e){"function"==typeof e&&t.push(e)},e.removeURLTemplateFilter=function(){return t.pop()},e.countURLTemplateFilters=function(){return t.length},e.clearUrlTemplateFilters=function(){return t=[]},e.parse=function(t,e,i){return i||("function"==typeof e&&(i=e),e={}),this._parse(t,null,e,(function(t,e){return i(e,t)}))},e.vent=new n,e.track=function(t,e){return this.vent.emit("VAST-error",e),v.track(t,e)},e.on=function(t,e){return this.vent.on(t,e)},e.once=function(t,e){return this.vent.once(t,e)},e._parse=function(e,i,n,s){var o,a,l,u;for(s||("function"==typeof n&&(s=n),n={}),a=0,l=t.length;a<l;a++)o=t[a],e=o(e);return null==i&&(i=[]),i.push(e),r.get(e,n,(u=this,function(t,r){var o,a,l,c,h,p,d,f,m,v,y;if(null!=t)return s(t);if(y=new g,null==(null!=r?r.documentElement:void 0)||"VAST"!==r.documentElement.nodeName)return s(new Error("Invalid VAST XMLDocument"));for(l=0,h=(m=r.documentElement.childNodes).length;l<h;l++)"Error"===(f=m[l]).nodeName&&y.errorURLTemplates.push(u.parseNodeText(f));for(c=0,p=(v=r.documentElement.childNodes).length;c<p;c++)"Ad"===(f=v[c]).nodeName&&(null!=(o=u.parseAdElement(f))?(o.xml=r,y.ads.push(o)):u.track(y.errorURLTemplates,{ERRORCODE:101}));for(a=function(t,e){var i,n,r,a;if(null==t&&(t=null),null==e&&(e=!1),y){for(r=!0,i=0,n=(a=y.ads).length;i<n;i++){if(null!=(o=a[i]).nextWrapperURL)return;o.creatives.length>0&&(r=!1)}return r&&(e||u.track(y.errorURLTemplates,{ERRORCODE:303})),0===y.ads.length&&(y=null),s(t,y)}},d=y.ads.length;d--;)null!=(o=y.ads[d]).nextWrapperURL&&function(t){var r,s,o;i.length>(null!==n.wrapperLimit?n.wrapperLimit:9)||(o=t.nextWrapperURL,T.call(i,o)>=0)?(u.track(t.errorURLTemplates,{ERRORCODE:302}),y.ads.splice(y.ads.indexOf(t),1),a(new Error("Wrapper limit reached, as defined by the video player"))):(0===t.nextWrapperURL.indexOf("//")?(s=location.protocol,t.nextWrapperURL=""+s+t.nextWrapperURL):-1===t.nextWrapperURL.indexOf("://")&&(r=e.slice(0,e.lastIndexOf("/")),t.nextWrapperURL=r+"/"+t.nextWrapperURL),u._parse(t.nextWrapperURL,i,n,(function(e,i){var n,r,s,o,l,c,h,p,d,f,m,g,v,T,k,A,R,b,L,x,U,C,E,w;if(s=!1,null!=e)u.track(t.errorURLTemplates,{ERRORCODE:301}),y.ads.splice(y.ads.indexOf(t),1),s=!0;else if(null==i)u.track(t.errorURLTemplates,{ERRORCODE:303}),y.ads.splice(y.ads.indexOf(t),1),s=!0;else for(y.errorURLTemplates=y.errorURLTemplates.concat(i.errorURLTemplates),l=y.ads.indexOf(t),y.ads.splice(l,1),c=0,h=(b=i.ads).length;c<h;c++){if((w=b[c]).lastURI||(w.lastURI={},w.lastURI.impressionURLTemplates||(w.lastURI.impressionURLTemplates=w.impressionURLTemplates),w.lastURI.errorURLTemplates||(w.lastURI.errorURLTemplates=w.errorURLTemplates),w.lastURI.trackingEvents=[]),w.errorURLTemplates=t.errorURLTemplates.concat(w.errorURLTemplates),w.impressionURLTemplates=t.impressionURLTemplates.concat(w.impressionURLTemplates),w.extensions=t.extensions.concat(w.extensions),null!=t.trackingEvents)for(v=0,p=(L=w.creatives).length;v<p;v++)if(r=L[v],null!=t.trackingEvents[r.type])for(T=0,d=(x=Object.keys(t.trackingEvents[r.type])).length;T<d;T++)o=x[T],(n=r.trackingEvents)[o]||(n[o]=[]),w.lastURI.trackingEvents[o]||(w.lastURI.trackingEvents[o]=[]),w.lastURI.trackingEvents[o]=w.lastURI.trackingEvents[o].concat(t.trackingEvents[r.type][o]),r.trackingEvents[o]=r.trackingEvents[o].concat(t.trackingEvents[r.type][o]);if(null!=t.videoClickTrackingURLTemplates)for(k=0,f=(U=w.creatives).length;k<f;k++)"linear"===(r=U[k]).type&&(w.lastURI.videoClickTrackingURLTemplates||(w.lastURI.videoClickTrackingURLTemplates=r.videoClickTrackingURLTemplates),r.videoClickTrackingURLTemplates=r.videoClickTrackingURLTemplates.concat(t.videoClickTrackingURLTemplates));if(null!=t.videoCustomClickURLTemplates)for(A=0,m=(C=w.creatives).length;A<m;A++)"linear"===(r=C[A]).type&&(r.videoCustomClickURLTemplates=r.videoCustomClickURLTemplates.concat(t.videoCustomClickURLTemplates));if(null!=t.videoClickThroughURLTemplate)for(R=0,g=(E=w.creatives).length;R<g;R++)"linear"===(r=E[R]).type&&null==r.videoClickThroughURLTemplate&&(r.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate);y.ads.splice(++l,0,w)}return delete t.nextWrapperURL,a(e,s)})))}(o);return a()}))},e.childByName=function(t,e){var i,n,r,s;for(n=0,r=(s=t.childNodes).length;n<r;n++)if((i=s[n]).nodeName===e)return i},e.childsByName=function(t,e){var i,n,r,s,o;for(n=[],r=0,s=(o=t.childNodes).length;r<s;r++)(i=o[r]).nodeName===e&&n.push(i);return n},e.parseAdElement=function(t){var e,i,n,r,s;for(i=0,n=(r=t.childNodes).length;i<n;i++)if("Wrapper"===(s=(e=r[i]).nodeName)||"InLine"===s){if(this.copyNodeAttribute("id",t,e),this.copyNodeAttribute("sequence",t,e),"Wrapper"===e.nodeName)return this.parseWrapperElement(e);if("InLine"===e.nodeName)return this.parseInLineElement(e)}},e.parseWrapperElement=function(t){var e,i,n,r,s,o,a;for(e=this.parseInLineElement(t),null!=(a=this.childByName(t,"VASTAdTagURI"))?e.nextWrapperURL=this.parseNodeText(a):null!=(a=this.childByName(t,"VASTAdTagURL"))&&(e.nextWrapperURL=this.parseNodeText(this.childByName(a,"URL"))),n=0,r=(s=e.creatives).length;n<r;n++)o=null,"linear"!==(i=s[n]).type&&"nonlinear"!==i.type||null!=(o=i)&&(null!=o.trackingEvents&&(e.trackingEvents||(e.trackingEvents={}),e.trackingEvents[o.type]=o.trackingEvents),null!=o.videoClickTrackingURLTemplates&&(e.videoClickTrackingURLTemplates=o.videoClickTrackingURLTemplates),null!=o.videoClickThroughURLTemplate&&(e.videoClickThroughURLTemplate=o.videoClickThroughURLTemplate),null!=o.videoCustomClickURLTemplates&&(e.videoCustomClickURLTemplates=o.videoCustomClickURLTemplates));if(null!=e.nextWrapperURL)return e},e.parseInLineElement=function(t){var e,i,n,r,o,a,l,u,c,h,p,d,f,m,g;for((e=new s).id=t.getAttribute("id")||null,e.sequence=t.getAttribute("sequence")||null,a=0,c=(f=t.childNodes).length;a<c;a++)switch((d=f[a]).nodeName){case"Error":e.errorURLTemplates.push(this.parseNodeText(d));break;case"Impression":e.impressionURLTemplates.push(this.parseNodeText(d));break;case"Creatives":for(l=0,h=(m=this.childsByName(d,"Creative")).length;l<h;l++)for(n={id:(r=m[l]).getAttribute("id")||null,adId:this.parseCreativeAdIdAttribute(r),sequence:r.getAttribute("sequence")||null,apiFramework:r.getAttribute("apiFramework")||null},u=0,p=(g=r.childNodes).length;u<p;u++)switch((o=g[u]).nodeName){case"Linear":(i=this.parseCreativeLinearElement(o,n))&&e.creatives.push(i);break;case"NonLinearAds":(i=this.parseNonLinear(o,n))&&e.creatives.push(i);break;case"CompanionAds":(i=this.parseCompanionAd(o,n))&&e.creatives.push(i)}break;case"Extensions":this.parseExtension(e.extensions,this.childsByName(d,"Extension"));break;case"AdSystem":e.system={value:this.parseNodeText(d),version:d.getAttribute("version")||null};break;case"AdTitle":e.title=this.parseNodeText(d);break;case"Description":e.description=this.parseNodeText(d);break;case"Advertiser":e.advertiser=this.parseNodeText(d);break;case"Pricing":e.pricing={value:this.parseNodeText(d),model:d.getAttribute("model")||null,currency:d.getAttribute("currency")||null};break;case"Survey":e.survey=this.parseNodeText(d)}return e},e.parseExtension=function(t,e){var i,n,r,s,l,u,c,h,p,d,f,m,g,v,T,y,k,A,R;for(A=[],c=0,f=e.length;c<f;c++){if(l=e[c],n=new o,l.attributes)for(h=0,m=(T=l.attributes).length;h<m;h++)u=T[h],n.attributes[u.nodeName]=u.nodeValue;for(p=0,g=(y=l.childNodes).length;p<g;p++)if(i=y[p],R=this.parseNodeText(i),"#comment"!==i.nodeName&&""!==R){if((r=new a).name=i.nodeName,r.value=R,i.attributes)for(d=0,v=(k=i.attributes).length;d<v;d++)s=k[d],r.attributes[s.nodeName]=s.nodeValue;n.children.push(r)}A.push(t.push(n))}return A},e.parseCreativeLinearElement=function(t,e){var i,n,r,s,o,a,l,u,h,f,m,g,v,T,y,k,A,R,b,L,x,U,C,E,w,N,_,I,D,S,O,V,B,F,M,P,H,W,q,j,X,z,Y,G,Q,J,$,K,Z,tt,et,it,nt,rt,st,ot,at,lt,ut;if((s=new c(e)).duration=this.parseDuration(this.parseNodeText(this.childByName(t,"Duration"))),-1===s.duration&&"Wrapper"!==t.parentNode.parentNode.parentNode.nodeName)return null;if(null==(rt=t.getAttribute("skipoffset"))?s.skipDelay=null:"%"===rt.charAt(rt.length-1)?(W=parseInt(rt,10),s.skipDelay=s.duration*(W/100)):s.skipDelay=this.parseDuration(rt),null!=(ut=this.childByName(t,"VideoClicks"))){for(s.videoClickThroughURLTemplate=this.parseNodeText(this.childByName(ut,"ClickThrough")),u=0,R=(X=this.childsByName(ut,"ClickTracking")).length;u<R;u++)r=X[u],s.videoClickTrackingURLTemplates.push(this.parseNodeText(r));for(y=0,b=(z=this.childsByName(ut,"CustomClick")).length;y<b;y++)o=z[y],s.videoCustomClickURLTemplates.push(this.parseNodeText(o))}for(null!=(i=this.childByName(t,"AdParameters"))&&(s.adParameters=this.parseNodeText(i)),k=0,x=(G=this.childsByName(t,"TrackingEvents")).length;k<x;k++)for(at=G[k],A=0,U=(Q=this.childsByName(at,"Tracking")).length;A<U;A++)if(a=(ot=Q[A]).getAttribute("event"),lt=this.parseNodeText(ot),null!=a&&null!=lt){if("progress"===a){if(!(P=ot.getAttribute("offset")))continue;a="%"===P.charAt(P.length-1)?"progress-"+P:"progress-"+Math.round(this.parseDuration(P))}null==(n=s.trackingEvents)[a]&&(n[a]=[]),s.trackingEvents[a].push(lt)}for(D=0,C=(J=this.childsByName(t,"MediaFiles")).length;D<C;D++)for(B=J[D],F=0,E=($=this.childsByName(B,"MediaFile")).length;F<E;F++)V=$[F],(O=new d).id=V.getAttribute("id"),O.fileURL=this.parseNodeText(V),O.deliveryType=V.getAttribute("delivery"),O.codec=V.getAttribute("codec"),O.mimeType=V.getAttribute("type"),O.apiFramework=V.getAttribute("apiFramework"),O.bitrate=parseInt(V.getAttribute("bitrate")||0),O.minBitrate=parseInt(V.getAttribute("minBitrate")||0),O.maxBitrate=parseInt(V.getAttribute("maxBitrate")||0),O.width=parseInt(V.getAttribute("width")||0),O.height=parseInt(V.getAttribute("height")||0),(nt=V.getAttribute("scalable"))&&"string"==typeof nt&&("true"===(nt=nt.toLowerCase())?O.scalable=!0:"false"===nt&&(O.scalable=!1)),(S=V.getAttribute("maintainAspectRatio"))&&"string"==typeof S&&("true"===(S=S.toLowerCase())?O.maintainAspectRatio=!0:"false"===S&&(O.maintainAspectRatio=!1)),s.mediaFiles.push(O);if(null!=(v=this.childByName(t,"Icons")))for(M=0,w=(K=this.childsByName(v,"Icon")).length;M<w;M++){for(g=K[M],(h=new p).program=g.getAttribute("program"),h.height=parseInt(g.getAttribute("height")||0),h.width=parseInt(g.getAttribute("width")||0),h.xPosition=this.parseXPosition(g.getAttribute("xPosition")),h.yPosition=this.parseYPosition(g.getAttribute("yPosition")),h.apiFramework=g.getAttribute("apiFramework"),h.offset=this.parseDuration(g.getAttribute("offset")),h.duration=this.parseDuration(g.getAttribute("duration")),H=0,N=(Z=this.childsByName(g,"HTMLResource")).length;H<N;H++)l=Z[H],h.type=l.getAttribute("creativeType")||"text/html",h.htmlResource=this.parseNodeText(l);for(q=0,_=(tt=this.childsByName(g,"IFrameResource")).length;q<_;q++)T=tt[q],h.type=T.getAttribute("creativeType")||0,h.iframeResource=this.parseNodeText(T);for(j=0,I=(et=this.childsByName(g,"StaticResource")).length;j<I;j++)st=et[j],h.type=st.getAttribute("creativeType")||0,h.staticResource=this.parseNodeText(st);if(null!=(m=this.childByName(g,"IconClicks")))for(h.iconClickThroughURLTemplate=this.parseNodeText(this.childByName(m,"IconClickThrough")),it=0,L=(Y=this.childsByName(m,"IconClickTracking")).length;it<L;it++)f=Y[it],h.iconClickTrackingURLTemplates.push(this.parseNodeText(f));h.iconViewTrackingURLTemplate=this.parseNodeText(this.childByName(g,"IconViewTracking")),s.icons.push(h)}return s},e.parseNonLinear=function(t,e){var i,n,r,s,o,a,l,u,c,p,d,m,g,v,T,y,k,A,R,b,L,x,U,C,E,w,N,_,I,D,S,O,V,B;for(s=new h(e),l=0,m=(C=this.childsByName(t,"TrackingEvents")).length;l<m;l++)for(V=C[l],c=0,g=(E=this.childsByName(V,"Tracking")).length;c<g;c++)o=(O=E[c]).getAttribute("event"),B=this.parseNodeText(O),null!=o&&null!=B&&(null==(n=s.trackingEvents)[o]&&(n[o]=[]),s.trackingEvents[o].push(B));for(p=0,v=(w=this.childsByName(t,"NonLinear")).length;p<v;p++){for(x=w[p],(L=new f).id=x.getAttribute("id")||null,L.width=x.getAttribute("width"),L.height=x.getAttribute("height"),L.expandedWidth=x.getAttribute("expandedWidth"),L.expandedHeight=x.getAttribute("expandedHeight"),L.scalable=this.parseBoolean(x.getAttribute("scalable")),L.maintainAspectRatio=this.parseBoolean(x.getAttribute("maintainAspectRatio")),L.minSuggestedDuration=this.parseDuration(x.getAttribute("minSuggestedDuration")),L.apiFramework=x.getAttribute("apiFramework"),d=0,T=(N=this.childsByName(x,"HTMLResource")).length;d<T;d++)a=N[d],L.type=a.getAttribute("creativeType")||"text/html",L.htmlResource=this.parseNodeText(a);for(R=0,y=(_=this.childsByName(x,"IFrameResource")).length;R<y;R++)u=_[R],L.type=u.getAttribute("creativeType")||0,L.iframeResource=this.parseNodeText(u);for(b=0,k=(I=this.childsByName(x,"StaticResource")).length;b<k;b++)S=I[b],L.type=S.getAttribute("creativeType")||0,L.staticResource=this.parseNodeText(S);for(null!=(i=this.childByName(x,"AdParameters"))&&(L.adParameters=this.parseNodeText(i)),L.nonlinearClickThroughURLTemplate=this.parseNodeText(this.childByName(x,"NonLinearClickThrough")),U=0,A=(D=this.childsByName(x,"NonLinearClickTracking")).length;U<A;U++)r=D[U],L.nonlinearClickTrackingURLTemplates.push(this.parseNodeText(r));s.variations.push(L)}return s},e.parseCompanionAd=function(t,e){var i,n,r,s,o,a,c,h,p,d,f,m,g,v,T,y,k,A,R,b,L,x,U,C,E,w,N,_,I,D,S,O,V,B,F,M,P;for(a=new u(e),p=0,v=(w=this.childsByName(t,"Companion")).length;p<v;p++){for(o=w[p],(s=new l).id=o.getAttribute("id")||null,s.width=o.getAttribute("width"),s.height=o.getAttribute("height"),s.companionClickTrackingURLTemplates=[],f=0,T=(N=this.childsByName(o,"HTMLResource")).length;f<T;f++)h=N[f],s.type=h.getAttribute("creativeType")||"text/html",s.htmlResource=this.parseNodeText(h);for(m=0,y=(_=this.childsByName(o,"IFrameResource")).length;m<y;m++)d=_[m],s.type=d.getAttribute("creativeType")||0,s.iframeResource=this.parseNodeText(d);for(g=0,k=(I=this.childsByName(o,"StaticResource")).length;g<k;g++){for(B=I[g],s.type=B.getAttribute("creativeType")||0,x=0,A=(D=this.childsByName(o,"AltText")).length;x<A;x++)n=D[x],s.altText=this.parseNodeText(n);s.staticResource=this.parseNodeText(B)}for(U=0,R=(S=this.childsByName(o,"TrackingEvents")).length;U<R;U++)for(M=S[U],C=0,b=(O=this.childsByName(M,"Tracking")).length;C<b;C++)c=(F=O[C]).getAttribute("event"),P=this.parseNodeText(F),null!=c&&null!=P&&(null==(i=s.trackingEvents)[c]&&(i[c]=[]),s.trackingEvents[c].push(P));for(E=0,L=(V=this.childsByName(o,"CompanionClickTracking")).length;E<L;E++)r=V[E],s.companionClickTrackingURLTemplates.push(this.parseNodeText(r));s.companionClickThroughURLTemplate=this.parseNodeText(this.childByName(o,"CompanionClickThrough")),s.companionClickTrackingURLTemplate=this.parseNodeText(this.childByName(o,"CompanionClickTracking")),a.variations.push(s)}return a},e.parseDuration=function(t){var e,i,n,r,s;return null==t?-1:v.isNumeric(t)?parseInt(t):3!==(e=t.split(":")).length?-1:(s=e[2].split("."),r=parseInt(s[0]),2===s.length&&(r+=parseFloat("0."+s[1])),n=parseInt(60*e[1]),i=parseInt(60*e[0]*60),isNaN(i||isNaN(n||isNaN(r||n>3600||r>60)))?-1:i+n+r)},e.parseXPosition=function(t){return"left"===t||"right"===t?t:parseInt(t||0)},e.parseYPosition=function(t){return"top"===t||"bottom"===t?t:parseInt(t||0)},e.parseBoolean=function(t){return"true"===t||"TRUE"===t||"1"===t},e.parseNodeText=function(t){return t&&(t.textContent||t.text||"").trim()},e.copyNodeAttribute=function(t,e,i){var n;if(n=e.getAttribute(t))return i.setAttribute(t,n)},e.parseCreativeAdIdAttribute=function(t){return t.getAttribute("AdID")||t.getAttribute("adID")||t.getAttribute("adId")||null},e}(),e.exports=m},{"./ad":2,"./companionad":4,"./creative":5,"./extension":6,"./extensionchild":7,"./icon":8,"./mediafile":10,"./nonlinear":11,"./response":13,"./urlhandler":15,"./util":18,events:1}],13:[function(t,e,i){var n;n=function(){this.ads=[],this.errorURLTemplates=[]},e.exports=n},{}],14:[function(t,e,i){var n,r,s,o,a,l,u={}.hasOwnProperty;n=t("./client"),l=t("./util"),s=t("./creative").VASTCreativeLinear,o=t("./nonlinear"),r=t("./companionad"),a=function(t){function e(t,e,i){var a,l,u;for(a in this.ad=t,this.creative=e,this.variation=null!=i?i:null,this.muted=!1,this.impressed=!1,this.skipable=!1,this.skipDelayDefault=-1,this.trackingEvents={},this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],u=this.creative.trackingEvents)l=u[a],this.trackingEvents[a]=l.slice(0);this.creative instanceof s?(this.setDuration(this.creative.duration),this.skipDelay=this.creative.skipDelay,this.linear=!0,this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates):(this.skipDelay=-1,this.linear=!1,this.variation&&(this.variation instanceof o?(this.clickThroughURLTemplate=this.variation.nonlinearClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.nonlinearClickTrackingURLTemplates):this.variation instanceof r&&(this.clickThroughURLTemplate=this.variation.companionClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.companionClickTrackingURLTemplates))),this.on("start",(function(){n.lastSuccessfullAd=+new Date}))}return function(t,e){for(var i in e)u.call(e,i)&&(t[i]=e[i]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.prototype.setDuration=function(t){return this.assetDuration=t,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}},e.prototype.setProgress=function(t){var e,i,n,r,s,o,a,l,u;if(-1===(l=null===this.skipDelay?this.skipDelayDefault:this.skipDelay)||this.skipable||(l>t?this.emit("skip-countdown",l-t):(this.skipable=!0,this.emit("skip-countdown",0))),this.linear&&this.assetDuration>0){if(i=[],t>0)for(o in i.push("start"),s=Math.round(t/this.assetDuration*100),i.push("progress-"+s+"%"),i.push("progress-"+Math.round(t)),a=this.quartiles)(u=a[o])<=t&&t<=u+1&&i.push(o);for(n=0,r=i.length;n<r;n++)e=i[n],this.track(e,!0);t<this.progress&&this.track("rewind")}return this.progress=t},e.prototype.setMuted=function(t){return this.muted!==t&&this.track(t?"mute":"unmute"),this.muted=t},e.prototype.setPaused=function(t){return this.paused!==t&&this.track(t?"pause":"resume"),this.paused=t},e.prototype.setFullscreen=function(t){return this.fullscreen!==t&&this.track(t?"fullscreen":"exitFullscreen"),this.fullscreen=t},e.prototype.setExpand=function(t){return this.expanded!==t&&this.track(t?"expand":"collapse"),this.expanded=t},e.prototype.setSkipDelay=function(t){if("number"==typeof t)return this.skipDelay=t},e.prototype.load=function(){if(!this.impressed)return this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView")},e.prototype.errorWithCode=function(t){return this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:t})},e.prototype.complete=function(){return this.track("complete")},e.prototype.close=function(){return this.track(this.linear?"closeLinear":"close")},e.prototype.stop=function(){},e.prototype.skip=function(){return this.track("skip"),this.trackingEvents=[]},e.prototype.click=function(){var t,e,i;if((null!=(e=this.clickTrackingURLTemplates)?e.length:void 0)&&this.trackURLs(this.clickTrackingURLTemplates),null!=this.clickThroughURLTemplate)return this.linear&&(i={CONTENTPLAYHEAD:this.progressFormated()}),t=l.resolveURLTemplates([this.clickThroughURLTemplate],i)[0],this.emit("clickthrough",t)},e.prototype.track=function(t,e){var i,n;null==e&&(e=!1),"closeLinear"===t&&null==this.trackingEvents[t]&&null!=this.trackingEvents.close&&(t="close"),n=this.trackingEvents[t],i=this.emitAlwaysEvents.indexOf(t),null!=n?(this.emit(t,""),this.trackURLs(n)):-1!==i&&this.emit(t,""),!0===e&&(delete this.trackingEvents[t],i>-1&&this.emitAlwaysEvents.splice(i,1))},e.prototype.trackURLs=function(t,e){var i;return null==e&&(e={}),this.linear&&(null!=(null!=(i=this.creative.mediaFiles[0])?i.fileURL:void 0)&&(e.ASSETURI=this.creative.mediaFiles[0].fileURL),e.CONTENTPLAYHEAD=this.progressFormated()),l.track(t,e)},e.prototype.progressFormated=function(){var t,e,i,n;return(t=(n=parseInt(this.progress))/3600).length<2&&(t="0"+t),(e=n/60%60).length<2&&(e="0"+e),(i=n%60).length<2&&(i="0"+e),t+":"+e+":"+i+"."+parseInt(100*(this.progress-n))},e}(t("events").EventEmitter),e.exports=a},{"./client":3,"./companionad":4,"./creative":5,"./nonlinear":11,"./util":18,events:1}],15:[function(t,e,i){var n,r,s;s=t("./urlhandlers/xmlhttprequest"),r=t("./urlhandlers/flash"),n=function(){function e(){}return e.get=function(e,i,n){var o,a;return n||("function"==typeof i&&(n=i),i={}),null!=i.response?(a=i.response,delete i.response,n(null,a)):(null!=(o=i.urlhandler)?o.supported():void 0)?i.urlhandler.get(e,i,n):"undefined"==typeof window||null===window?t("./urlhandlers/node").get(e,i,n):s.supported()?s.get(e,i,n):r.supported()?r.get(e,i,n):n(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))},e}(),e.exports=n},{"./urlhandlers/flash":16,"./urlhandlers/xmlhttprequest":17}],16:[function(t,e,i){var n;n=function(){function t(){}return t.xdr=function(){var t;return window.XDomainRequest&&(t=new XDomainRequest),t},t.supported=function(){return!!this.xdr()},t.get=function(t,e,i){var n,r;return(r="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(r.async=!1,(n=this.xdr()).open("GET",t),n.timeout=e.timeout||0,n.withCredentials=e.withCredentials||!1,n.send(),n.onprogress=function(){},n.onload=function(){return r.loadXML(n.responseText),i(null,r)}):i(new Error("FlashURLHandler: Microsoft.XMLDOM format not supported"))},t}(),e.exports=n},{}],17:[function(t,e,i){var n;n=function(){function t(){}return t.xhr=function(){var t;if("withCredentials"in(t=new window.XMLHttpRequest))return t},t.supported=function(){return!!this.xhr()},t.get=function(t,e,i){var n;if("https:"===window.location.protocol&&0===t.indexOf("http://"))return i(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{return(n=this.xhr()).open("GET",t),n.timeout=e.timeout||0,n.withCredentials=e.withCredentials||!1,n.overrideMimeType&&n.overrideMimeType("text/xml"),n.onreadystatechange=function(){if(4===n.readyState)return 200===n.status?i(null,n.responseXML):i(new Error("XHRURLHandler: "+n.statusText))},n.send()}catch(t){return i(new Error("XHRURLHandler: Unexpected error"))}},t}(),e.exports=n},{}],18:[function(t,e,i){var n;n=function(){function t(){}return t.track=function(t,e){var i,n,r,s,o,a;for(a=[],s=0,o=(n=this.resolveURLTemplates(t,e)).length;s<o;s++)i=n[s],"undefined"!=typeof window&&null!==window&&(r=new Image,a.push(r.src=i));return a},t.resolveURLTemplates=function(t,e){var i,n,r,s,o,a,l,u;for(null==e&&(e={}),i=[],null!=e.ASSETURI&&(e.ASSETURI=this.encodeURIComponentRFC3986(e.ASSETURI)),null!=e.CONTENTPLAYHEAD&&(e.CONTENTPLAYHEAD=this.encodeURIComponentRFC3986(e.CONTENTPLAYHEAD)),null==e.ERRORCODE||/^[0-9]{3}$/.test(e.ERRORCODE)||(e.ERRORCODE=900),e.CACHEBUSTING=this.leftpad(Math.round(1e8*Math.random()).toString()),e.TIMESTAMP=this.encodeURIComponentRFC3986((new Date).toISOString()),e.RANDOM=e.random=e.CACHEBUSTING,n=0,s=t.length;n<s;n++)if(l=t[n]){for(r in e)u=e[r],o="["+r+"]",a="%%"+r+"%%",l=(l=l.replace(o,u)).replace(a,u);i.push(l)}return i},t.encodeURIComponentRFC3986=function(t){return encodeURIComponent(t).replace(/[!'()*]/g,(function(t){return"%"+t.charCodeAt(0).toString(16)}))},t.leftpad=function(t){return t.length<8?function(){var e,i,n;for(n=[],e=0,i=8-t.length;0<=i?e<i:e>i;0<=i?e++:e--)n.push("0");return n}().join("")+t:t},t.storage=function(){var t,e;try{e="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(t){t,e=null}return(null==e||function(t){var e;try{if(e="__VASTUtil__",t.setItem(e,e),t.getItem(e)!==e)return!0}catch(t){return t,!0}return!1}(e))&&(t={},e={length:0,getItem:function(e){return t[e]},setItem:function(e,i){t[e]=i,this.length=Object.keys(t).length},removeItem:function(e){delete t[e],this.length=Object.keys(t).length},clear:function(){t={},this.length=0}}),e}(),t.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},t}(),e.exports=n},{}]},{},[9])(9)})),function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[o]={exports:{}};e[o][0].call(c.exports,(function(t){var i=e[o][1][t];return r(i||t)}),c,c.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){"use strict";var n=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"];function r(t,e,i){}r.prototype.handshakeVersion=function(t,e){},r.prototype.initAd=function(t,e,i,n,r,s,o){},r.prototype.startAd=function(t){},r.prototype.stopAd=function(t){},r.prototype.skipAd=function(t){},r.prototype.resizeAd=function(t,e,i,n){},r.prototype.pauseAd=function(t){},r.prototype.resumeAd=function(t){},r.prototype.expandAd=function(t){},r.prototype.collapseAd=function(t){},r.prototype.subscribe=function(t,e,i){},r.prototype.unsubscribe=function(t,e){},r.prototype.getAdLinear=function(t){},r.prototype.getAdWidth=function(t){},r.prototype.getAdHeight=function(t){},r.prototype.getAdExpanded=function(t){},r.prototype.getAdSkippableState=function(t){},r.prototype.getAdRemainingTime=function(t){},r.prototype.getAdDuration=function(t){},r.prototype.getAdVolume=function(t){},r.prototype.getAdCompanions=function(t){},r.prototype.getAdIcons=function(t){},r.prototype.setAdVolume=function(t,e){},o(r,"METHODS",n),o(r,"GETTERS",["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"]),o(r,"SETTERS",["setAdVolume"]),o(r,"EVENTS",["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"]);var s=n.filter((function(t){return-1===["skipAd"].indexOf(t)}));function o(t,e,i){Object.defineProperty(t,e,{writable:!1,configurable:!1,value:i})}o(r,"checkVPAIDInterface",(function(t){return s.every((function(e){return"function"==typeof t[e]}))})),e.exports=r},{}],2:[function(t,e,i){"use strict";var n=t("./IVPAIDAdUnit"),r=t("./subscriber"),s=n.checkVPAIDInterface,o=t("./utils"),a=(n.METHODS,"AdClickThru"),l=n.EVENTS.filter((function(t){return t!=a}));function u(t,e,i,n){this._isValid=s(t),this._isValid&&(this._creative=t,this._el=e,this._videoEl=i,this._iframe=n,this._subscribers=new r,o.setFullSizeStyle(e),c.call(this))}function c(){if(l.forEach(function(t){this._creative.subscribe(p.bind(this,t),t)}.bind(this)),this._creative.subscribe(h.bind(this),a),this._videoEl){var t=this._iframe.contentDocument.documentElement,e=this._videoEl;t.addEventListener("click",(function(i){i.target===t&&e.click()}))}}function h(t,e,i){this._subscribers.triggerSync(a,{url:t,id:e,playerHandles:i})}function p(t){this._subscribers.trigger(t,Array.prototype.slice(arguments,1))}function d(t,e,i,n){t?t(i,n):i&&e.trigger("AdError",i)}u.prototype=Object.create(n.prototype),u.prototype.isValidVPAIDAd=function(){return this._isValid},n.METHODS.forEach((function(t){-1===["subscribe","unsubscribe","initAd"].indexOf(t)&&(u.prototype[t]=function(){var e=n.prototype[t].length,i=Array.prototype.slice.call(arguments),r=e===i.length?i.pop():void 0;setTimeout(function(){var e,n=null;try{e=this._creative[t].apply(this._creative,i)}catch(t){n=t}d(r,this._subscribers,n,e)}.bind(this),0)})})),u.prototype.initAd=function(t,e,i,n,r,s,a){r=r||{},s=o.extend({slot:this._el,videoSlot:this._videoEl},s||{}),setTimeout(function(){var o;try{this._creative.initAd(t,e,i,n,r,s)}catch(t){o=t}d(a,this._subscribers,o)}.bind(this),0)},u.prototype.subscribe=function(t,e,i){this._subscribers.subscribe(e,t,i)},u.prototype.unsubscribe=function(t,e){this._subscribers.unsubscribe(e,t)},u.prototype.on=u.prototype.subscribe,u.prototype.off=u.prototype.unsubscribe,n.GETTERS.forEach((function(t){u.prototype[t]=function(e){setTimeout(function(){var i,n=null;try{i=this._creative[t]()}catch(t){n=t}d(e,this._subscribers,n,i)}.bind(this),0)}})),u.prototype.setAdVolume=function(t,e){setTimeout(function(){var i,n=null;try{this._creative.setAdVolume(t),i=this._creative.getAdVolume()}catch(t){n=t}n||(n=o.validate(i===t,"failed to apply volume: "+t)),d(e,this._subscribers,n,i)}.bind(this),0)},u.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()},e.exports=u},{"./IVPAIDAdUnit":1,"./subscriber":4,"./utils":5}],3:[function(t,e,i){"use strict";var n=t("./utils"),r=n.unique("vpaidIframe"),s=t("./VPAIDAdUnit");function o(t,e,i,n){i=i||{},this._id=r(),this._destroyed=!1,n||(n={timeout:5e3,element:".player-vast-vpaid"}),this._frameContainer=document.querySelector(n.element),this._videoEl=e,this._vpaidOptions=n||{timeout:1e4},this._templateConfig={template:i.template||'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"><\/script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');<\/script></body></html>',extraOptions:i.extraOptions||{}}}function a(t){var e=this[t];e&&(e.remove(),delete this[t])}function l(){c.call(this),delete this._adUnit}function u(){c.call(this),p.call(this)}function c(){a.call(this,"_frame"),h.call(this)}function h(){this._onLoad&&(window.removeEventListener("message",this._onLoad),delete this._onLoad)}function p(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}function d(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}function f(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}o.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,u.call(this))},o.prototype.isDestroyed=function(){return this._destroyed},o.prototype.loadAdUnit=function(t,e){if(!this._onLoad){d.call(this),u.call(this);var i=this,r=n.createIframeWithContent(this._frameContainer,this._templateConfig.template,n.extend({iframeURL_JS:t,iframeID:this.getID(),origin:f()},this._templateConfig.extraOptions));this._frame=r,this._onLoad=n.callbackTimeout(this._vpaidOptions.timeout,function(t){if(t.origin!==f())return;var r,o,a;if(JSON.parse(t.data).id!==i.getID())return;i._frame.contentWindow?(a=i._frame.contentWindow.getVPAIDAd,o=n.validate("function"==typeof a,"the ad didn't return a function to create an ad")):o="the iframe is not anymore in the DOM tree";if(!o){var u=i._frame.contentWindow.document.querySelector(".ad-element");(r=new s(a(),u,i._videoEl,i._frame)).subscribe("AdStopped",l.bind(i)),o=n.validate(r.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")}return i._adUnit=r,h.call(i),e(o,o?null:r),!0}.bind(this),function(){e("timeout",null)}.bind(this)),window.addEventListener("message",this._onLoad)}},o.prototype.unloadAdUnit=function(){u.call(this)},o.prototype.getID=function(){return this._id},e.exports=o,window.VPAIDHTML5Client=o},{"./VPAIDAdUnit":2,"./utils":5}],4:[function(t,e,i){"use strict";function n(){this._subscribers={}}n.prototype.subscribe=function(t,e,i){this.isHandlerAttached(t,e)||this.get(e).push({handler:t,context:i,eventName:e})},n.prototype.unsubscribe=function(t,e){this._subscribers[e]=this.get(e).filter((function(e){return t!==e.handler}))},n.prototype.unsubscribeAll=function(){this._subscribers={}},n.prototype.trigger=function(t,e){var i=this;this.get(t).concat(this.get("*")).forEach((function(t){setTimeout((function(){i.isHandlerAttached(t.handler,t.eventName)&&t.handler.call(t.context,e)}),0)}))},n.prototype.triggerSync=function(t,e){this.get(t).concat(this.get("*")).forEach((function(t){t.handler.call(t.context,e)}))},n.prototype.get=function(t){return this._subscribers[t]||(this._subscribers[t]=[]),this._subscribers[t]},n.prototype.isHandlerAttached=function(t,e){return this.get(e).some((function(e){return t===e.handler}))},e.exports=n},{}],5:[function(t,e,i){"use strict";function n(){}function r(t,e,i){var n=document.createElement("iframe");return n.src=e||"about:blank",n.marginWidth="0",n.marginHeight="0",n.frameBorder="0",n.width="100%",n.height="100%",s(n),i&&(n.style.zIndex=i),n.setAttribute("SCROLLING","NO"),t.innerHTML="",t.appendChild(n),n}function s(t){t&&(t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.margin="0px",t.style.padding="0px",t.style.border="none",t.style.width="100%",t.style.height="100%")}function o(t,e){return Object.keys(e).forEach((function(i){var n="object"==typeof n?JSON.stringify(e[i]):e[i];t=t.replace(new RegExp("{{"+i+"}}","g"),n)})),t}function a(t,e){var i=t.contentWindow&&t.contentWindow.document;return!!i&&(i.write(e),!0)}e.exports={noop:n,validate:function(t,e){return t?null:new Error(e)},callbackTimeout:function(t,e,i){var r,s;return s=setTimeout((function(){e=n,i()}),t),r=function(){e.apply(this,arguments)&&clearTimeout(s)},r},createElementInEl:function(t,e,i){var n=document.createElement(e);return i&&(n.id=i),t.appendChild(n),n},createIframeWithContent:function(t,e,i){var n=r(t,null,i.zIndex);if(a(n,o(e,i)))return n},createIframe:r,setFullSizeStyle:s,simpleTemplate:o,setIframeContent:a,extend:function(t,e){return Object.keys(e).forEach((function(i){t[i]=e[i]})),t},unique:function(t){var e=-1;return function(){return t+"_"+ ++e}}}},{}]},{},[3]);
